<!-- This template renders the /testing page.
     It shows a search bar and then displays matching rows grouped by table.
     It uses the shared base layout, navbar, and main styling. -->

{% extends "base.html" %}

{% block title %}Testing Environment - Search{% endblock %}

{% block content %}
  <div class="container page-container">

    <!-- Page title using the rounded header badge style -->
    <h1 class="header-badge">Testing Environment</h1>

    <!-- Search box card -->
    <div class="results-box mb-40">
      <h2>Search the full database (test area)</h2>
      <p>
        This is a sandbox page to test searching across multiple tables.
        Type a keyword (e.g. virus name, accession, partial sequence) and see
        where it appears in the database.
      </p>

      <!-- Search form; uses GET so the query shows as ?q= in the URL -->
      <form action="{{ url_for('testing') }}" method="get" class="mt-20">
        <input
          type="text"
          name="q"
          placeholder="Enter your search term..."
          value="{{ q }}"
          style="
            width: 70%;
            max-width: 500px;
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid #d1d5db;
            font-size: 1rem;
            margin-right: 10px;
          "
        >
        <button type="submit" class="button">Search</button>
      </form>
    </div>

    {% if not q %}
      <!-- Message shown when there is no query yet -->
      <div class="results-box">
        <h2>No query yet</h2>
        <p>Enter a search term above to search across virus, genome, protein, and enzyme tables.</p>
      </div>

    {% else %}

      {% if tables %}
        <!-- Summary of search when there are results -->
        <div class="results-box mb-40">
          <h2>Search results for "{{ q }}"</h2>
          <p>Found matches in {{ tables|length }} table{{ 's' if tables|length != 1 else '' }}.</p>
        </div>

        <!-- Loop over each table that had matching rows -->
        {% for table in tables %}
          <div class="results-box mb-40">
            <h2>{{ table.name }}</h2>

            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    {% for col in table.columns %}
                      <th>{{ col }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  {% for row in table.rows %}
                    <tr>
                      {% for cell in row %}
                        <!-- Each cell shown as plain text for now.
                             Later, we can add collapsing for long sequences again. -->
                        <td class="sequence-cell">
                          {{ cell }}
                        </td>
                      {% endfor %}
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        {% endfor %}

      {% else %}
        <!-- No results matched this query -->
        <div class="results-box">
          <h2>No results</h2>
          <p>Nothing in the database matched "<strong>{{ q }}</strong>". Try a different keyword.</p>
        </div>
      {% endif %}

    {% endif %}

  </div>
{% endblock %}