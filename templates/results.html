<!-- This template shows all database tables using the shared base layout,
     global styling (style.css), and navbar. Save this as: templates/results.html -->

{% extends "base.html" %}

{% block title %}BioQueryX - Results{% endblock %}

{% block content %}
  <div class="container page-container">

    <!-- Page header using the rounded header badge style -->
    <h1 class="header-badge">Results</h1>

    <!-- Intro card for the page -->
    <div class="results-box mb-40">
      <h2>All Tables in Database</h2>
      <p>
        Below are all tables loaded from the database. Each table is displayed in its own box
        with consistent styling so you can quickly browse the data.
      </p>
    </div>

    <!-- Loop over all tables passed from Flask (tables = [{name, columns, rows}, ...]) -->
    {% for table in tables %}
      <div class="results-box">

        <!-- Name of the current table -->
        <h2>{{ table.name }}</h2>

        <!-- Wrapper allows horizontal scrolling if the table is very wide -->
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                {% for col in table.columns %}
                  <th>{{ col }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in table.rows %}
              <tr>
                  {% for cell in row %}
                      <td class="sequence-cell">
                        {# CASE 1 — Cell is a string, possibly a long sequence #}
                        {% if cell is string %}
                            
                            {# Show short preview #}
                            <span class="seq-short">
                                {{ cell[:80] }}{% if cell|length > 80 %}...{% endif %}
                            </span>

                            {# Hidden full sequence #}
                            {% if cell|length > 60 %}
                                <span class="seq-full" style="display:none;">
                                    {{ cell }}
                                </span>
                                <button class="seq-toggle">Show more</button>
                            {% endif %}

                        {% else %}

                            {# CASE 2 — Cell is not a string (INTEGER, FLOAT, etc.) #}
                            {{ cell }}

                        {% endif %}

                    </td>
                  {% endfor %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    {% endfor %}

  </div>




  <script>
document.querySelectorAll(".seq-toggle").forEach(button => {
    button.addEventListener("click", () => {
        const cell = button.parentElement;
        const shortText = cell.querySelector(".seq-short");
        const fullText = cell.querySelector(".seq-full");

        if (fullText.style.display === "none") {
            fullText.style.display = "inline";
            shortText.style.display = "none";
            button.textContent = "Show less";
        } else {
            fullText.style.display = "none";
            shortText.style.display = "inline";
            button.textContent = "Show more";
        }
    });
});
</script>
{% endblock %}